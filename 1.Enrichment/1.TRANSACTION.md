# Transaction Enrichment

![Data Enrichment](../images/data-enrichment.png)

## We will send you a webhook notification (HTTP POST) in the following format:

```jsonc
{
    "event": "transaction",
    "payload": {
        "contractDisputeId": "d492bhhnshts7160i5g0", // Tupi Internal ID
        "transactionIdentifier": "431220079801", // TID (can be null)
        "acquirerReferenceNumber": "20099984311312200798013" // ARN (can be null)
    }
}
```

### Webhook Payload Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `event` | string | Yes | Event type identifier. Always "transaction" for transaction enrichment requests |
| `payload` | object | Yes | Container for the transaction identification data |
| `payload.contractDisputeId` | string | Yes | Tupi's internal unique identifier for the dispute contract |
| `payload.transactionIdentifier` | string | No | Transaction ID (TID). May be null depending on card brand |
| `payload.acquirerReferenceNumber` | string | No | Acquirer Reference Number (ARN). May be null depending on card brand |

> **Important:** Either `transactionIdentifier` (TID) or `acquirerReferenceNumber` (ARN) will always be provided, though one of them may be null depending on the card brand. **You must use whichever identifier is available** to look up the transaction in your system.

## You must then send us an HTTP POST request to the callback URL provided during setup (contact us if youâ€™re unsure which endpoint to use).

```jsonc
{
    "type": "transaction",
    "data": {
        "authorizationCode": "135644",
        "authorizationStatusCode": "00",
        "authorizationCurrencyCode": "986", // ISO 4217
        "authorizationSequentialNumber": "123456789",
        "authorizationDate": "2025-01-01T00:00:00.000Z",
        "authorizationAmount": 10000,// in cents = 100.00
 
        "acquirerReferenceNumber": "25699994259255249310221", // ARN
        "transactionIdentifier": "405088518881", // TID
        "terminalIdentifier": "00281236",
        "cardNumber": "50677*****6581" , // masked: keep first 6 digits and last 4 digits
        "paymentPlan": 1, // int

        // tip: same as sent by the brand
        "entryMode": "5",
        "electronicCommerceIndicator": "05", // ECI

        "installments": [
            {
                "acquirerReferenceNumber": "25699994259255249310222", // ARN
                "installmentNumber": 1, // int
                "installmentDate": "2025-01-01T00:00:00.000Z",
                "amount": 10000, // in cents = 100.00

				// enum: settled | scheduled | canceled | confirmed | sent
                "issuerSettlementStatus": "settled",
				
				// enum: settled | scheduled | canceled
                "merchantSettlementStatus": "settled"
            }
        ],
        "vouchers": [
            {
                "acquirerReferenceNumber": "25699994259255249310223", // ARN
                "amount": 100, // in cents = 1.00
                "voucherDate": "2025-01-01T00:00:00.000Z",
                "installmentNumber": 1
            }
        ]
    }
}
```

### Callback Request Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `type` | string | Yes | Request type identifier. Always "transaction" for transaction data |
| `data` | object | Yes | Container for the transaction data |
| `data.authorizationCode` | string | Yes | Authorization code from the transaction |
| `data.authorizationStatusCode` | string | No | Status code from the authorization (e.g., "00" for approved) |
| `data.authorizationCurrencyCode` | string | Yes | Currency code in ISO 4217 format (e.g., "986" for BRL) |
| `data.authorizationSystemTraceAuditNumber` | string | Yes | STAN or NSU of authorization |
| `data.authorizationDate` | string | Yes | Date and time of authorization in ISO 8601 format |
| `data.authorizationAmount` | number | Yes | Authorization amount in cents (e.g., 10000 = 100.00) |
| `data.acquirerReferenceNumber` | string | Yes | Acquirer Reference Number (ARN) |
| `data.transactionIdentifier` | string | No | Transaction ID (TID) |
| `data.terminalIdentifier` | string | No | Terminal identifier where the transaction occurred |
| `data.cardNumber` | string | Yes | Masked card number (first 6 and last 4 digits visible) |
| `data.paymentPlan` | number | Yes | Payment plan identifier |
| `data.entryMode` | string | Yes | Card entry mode (same as sent by the card brand) |
| `data.electronicCommerceIndicator` | string | Yes | Electronic Commerce Indicator (ECI) |
| `data.installments` | array | Yes | Array of installment objects for the transaction |
| `data.vouchers` | array | No | Array of voucher objects for the transaction |

### Installment Object Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `acquirerReferenceNumber` | string | Yes | ARN for this specific installment |
| `installmentNumber` | number | Yes | Installment sequence number |
| `installmentDate` | string | Yes | Date of the installment in ISO 8601 format |
| `amount` | number | Yes | Installment amount in cents |
| `issuerSettlementStatus` | string | Yes | Settlement status with issuer. Values: "settled", "scheduled", "canceled", "confirmed", "sent" |
| `merchantSettlementStatus` | string | Yes | Settlement status with merchant. Values: "settled", "scheduled", "canceled" |

### Voucher Object Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `acquirerReferenceNumber` | string | Yes | ARN for this specific voucher |
| `amount` | number | Yes | Voucher amount in cents |
| `voucherDate` | string | Yes | Date of the voucher in ISO 8601 format |
| `installmentNumber` | number | Yes | Associated installment number |